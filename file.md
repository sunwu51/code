## 我的创业过程中遇到的问题和解决方案
### 创业？
前一段时间我和几个同学还有几个公司的人一起做了一个创业的项目，是关于一个手机app的。我在项目中的角色是服务端的负责人。其实就我一个人做服务端，因为之前没有真正做过这种模式的项目，所以刚开始的时候有些犯怵，很多是平时不知道的东西要先去学习。另外因为各方面的考虑最后选择了用php来做服务端，而我的php水平是比较浅显的。所以在这个项目的进行过程中，我要不断遇到问题，探索问题，解决问题。
### php？
"世界上最好的语言"我个人不太喜欢写PHP，但是确实在做一个互联网项目的时候，需要考虑整合第三方的框架，比如聊天框架，支付宝微信支付框架等。这些框架往往只提供java .net 和 php三个版本的SDK和demo，如果这时候我们用的是python开发或者nodejs开发的服务端，那很多库还要自己封装，十分麻烦，而java的开发效率较低，对于原型服务来说不合适.net又要用非常不熟悉的windows服务器。所以客观来看php是最合适的。
### 框架？
虽然学过php的基础语法，但是想要用原生的php来写服务端确实不是一个明智的选择。单是数据库的查询就要超过业务逻辑的代码量了。而php的框架我只学过thinkphp这个简单（简陋）实用的，不过对于我们的app来说thinkphp的功能已经够用了。所以最后选择了thinkphp框架，来做服务端。版本是3.2.3版本。
### 短信验证
在注册的时候发送短信验证码，是我遇到的第一个问题，之前做的东西都是自己在玩，根本不会用到这种第三方的东西。第一次接触这种sdk还是有些胆怯的，不过仔细阅读了步骤，发现似乎并不难。因为服务器租了阿里的，所以短信的服务干脆也从阿里来租。于是查到了**阿里大于**http://www.alidayu.com。

阿里大于注册是免费的，而且上来会提供几块钱的免费券，可以让你测试发送短信，注册后（有淘宝账号直接登录）进入管理中心。需要做的步骤依次为：

1.应用管理-->应用列表-->创建应用-->给自己的应用起个名字
----------------------------------------用于获取AppKey、AppSecret

2.配置管理-->验证码-->配置短信签名-->添加签名-->填写一个名字和相关描述-->等待审核
----------------------------------------用于显示在短信的最前面表示电商名称

3.配置管理-->验证码-->配置短信模板-->添加模板（demo解释的很清楚）-->等待审核  
----------------------------------------短信的内容模板

4.应用测试-->选择应用名-->选择验证码服务-->选择短信发送API-->填写相关参数-->测试-->手机收到短信
------------------------本次测试的相关代码会动态生成，阿里大于提供了java.net php python curl c/c++ nodejs版本

除了短信服务器，我还遇到一个问题：短信的缓存和有效期，因为发送短信是一个请求，而验证短信是另一个请求。所以需要在发送的时候暂存一个键值对：手机号--验证码。然后等验证的请求发过来看是否一致。
缓存是必须的，想到还需要十分钟的短信有效期，所以最先想到的是redis的缓存。不过在仔细阅读了thinkphp的手册后发现有个S方法可以直接进行缓存。这个缓存是基于文件的，效率上比redis要差一些，但是不需要外部依赖。

### 聊天系统
我们的app中需要一个类似微信的这种实时的聊天系统，显然这种系统自己做的话是不可能的。还好也有相关的服务，这里我找到的是：**环信即时云通信**。环信服务器是免费的，这对开发者来说是件好事，可以免费的尝试下功能后再决定是否使用。环信服务申请的步骤就更简单了，只需要创建一个应用，然后就获得了相关的AppKey，Client ID，Client Secret了。具体服务端怎么创建用户，删除用户，修改密码等等操作，环信提供了非常良心的RESTful接口和文档http://api-docs.easemob.com，非常值得点赞。

我是负责服务端的，所以安卓和ios端的调用就没有研究过了。环信还支持web端的接入，感兴趣的可以研究下，这个可比自己实现的聊天室靠谱多了，而且代码还少。
### 发送邮件
我们的app中有邮箱认证的环节，这个功能中需要实现服务端自动往客户邮箱发送认证的邮件。phpMailer是公认的解决方案，他有着很简单的API调用，就能实现邮件的服务端发送。不过这里要先到邮箱设置客户端授权密码，程序中用这个授权码登录。虽然使用并不难，但是我还是遇到了问题：thinkphp框架如何把phpMailer整合进去。thinkphp中使用了.class.php的类文件命名方法，而且引入了命名空间。要用的其他框架显然不一定遵循这个规则，这样整合就比较费劲了。

好在thinkphp的用户群还是比较广的，虽然手册上在这一点上说的不是特别清楚，但社区的问题回答中很明确的回答了类似的问题。
只需要将依赖包放到`ThinkPHP/Library/Vendor`下就可以了。在用到这个包的地方通过vendor函数可以实现引用，参数中.代表下一级目录，而文件名中的.需要用#替换，php后缀不用写。如 `vendor('PHPMailer.class#phpmailer')`就是引用Vendor目录下的PHPMailer/class.phpmailer.php这个文件。
引用的文件可以本身就是一个类，也可以是一个`autoload.php`文件来加载各种类的。在具体实例化类的时候需要注意要加一个命名空间\，即`$mail = new \PHPMailer();`这样写才可以。
### 在线支付
整个项目中最麻烦的地方就是支付了。为了适用于大多数用户，我们必须考虑支付宝和微信两种支付方式，两套支付方案的开发，对我来说如同噩梦。加上网上可参考的文章较少且时间久远，而前不久阿里好像更新了新版的支付API，虽然旧版也能用，但是新上的app还是应该用新版。首先就是申请账户和app支付功能。



